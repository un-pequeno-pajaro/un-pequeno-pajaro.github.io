<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link type="image/png" rel="icon" href="media/potsa.png">
  <link rel="stylesheet" type="text/css" href="style.css">

  <meta property="theme-color" content="#b0865d">
  <meta property="og:site_name" content="Potsa">
  <meta property="og:title" content="POTSA">
  <meta property="og:description" content="Dios Patria y Potsa">
  <meta property="og:image" content="https://un-pequeno-pajaro.github.io/POTSA/media/potsa_god.png">
	<title>POTSA</title>

</head>
<body onclick="uneteanosotros()">
<div id="frame"></div>
<div id="tv-shadow"></div>
<div id="static-ov"></div>
<main>
	<p id="potsa_say"></p>
	<div class="center" id="confirm_box">Go to potsa.html ?<br>
		<button id="accept_bttn" onclick="goto_potsahtml()">Yes</button>
		<button id="accept_bttn" onclick="goto_potsahtml()">Yes !!</button>
	</div>

	<audio id="audio0" src="media/audio/0.mp3" type="audio/mpeg" loop></audio>
	<audio id="music0" src="media/audio/music0.mp3" type="audio/mpeg" loop></audio>

	<audio id="success_sfx_err" src="media/audio/fx/success_err1.mp3" type="audio/mpeg"></audio>
	<audio id="success_sfx" src="media/audio/fx/success.mp3" type="audio/mpeg"></audio>

	<audio id="hit_sound_0" src="media/audio/fx/hit/0.mp3" type="audio/mpeg"></audio>
	<audio id="hit_sound_1" src="media/audio/fx/hit/1.mp3" type="audio/mpeg"></audio>
	<audio id="hit_sound_2" src="media/audio/fx/hit/2.mp3" type="audio/mpeg"></audio>

	<audio id="ambient_loop_0" src="media/audio/ambient/loop_1.mp3" type="audio/mpeg" loop></audio>
</main>

<script type="text/javascript">

const audio0 = document.getElementById("audio0");
const music0 = document.getElementById("music0");
const success_sfx_err = document.getElementById("success_sfx_err");
const success_sfx = document.getElementById("success_sfx");

music0.volume = 0.6;

const hit_sound_0 = document.getElementById("hit_sound_0");
const hit_sound_1 = document.getElementById("hit_sound_1");
const hit_sound_2 = document.getElementById("hit_sound_2");

hit_sound_volume = 0.8;

hit_sound_0.volume = hit_sound_volume;
hit_sound_1.volume = hit_sound_volume;
hit_sound_2.volume = hit_sound_volume;

const ambient_loop_0 = document.getElementById("ambient_loop_0");

const potsa_confirm = document.getElementById('confirm_box');
const html = document.documentElement;
const body = document.body;


let unete_on = false;
let unete_disabled = false;

function uneteanosotros() {
	if (unete_on == false && unete_disabled == false) {

		audio0.play();
		html.style.filter = "contrast(200%)";

		unete_on = true;
	} else if (unete_on == true && unete_disabled == false) {

		audio0.pause();
		audio0.currentTime = 0;
		html.style.filter = "contrast(100%)";

		unete_on = false;
	} else {
		return;
	}
}

function randomHitSound() {
	let soundNum = (Math.floor(Math.random() * 3));

	if (soundNum == 0) {

		hit_sound_0.load();
		hit_sound_0.play();
	} else if (soundNum == 1) {

		hit_sound_1.load();
		hit_sound_1.play();
	} else if (soundNum == 2) {

		hit_sound_2.load();
		hit_sound_2.play();
	} else {
		return;
	}
}


function goto_potsahtml() {
	randomHitSound();
	potsa_confirm.style.display = 'none';

	setTimeout(function(){
		music0.pause();
		music0.currentTime = 0;
		window.open('files/potsa.html', '_blank');
		ambient_loop_0.play();
	},1000); //wait a second to open 'potsa.html'
}

function potsa_trigger() {
	if (unete_on == true) {uneteanosotros();}
	unete_disabled = true;

	success_sfx_err.load();
	success_sfx_err.play();

	setTimeout(function(){
		body.style.backgroundImage = "url('media/potsa_fly.gif')"
		body.style.cursor = 'inherit';
		html.style.filter = "contrast(200%)";
		music0.play();
		setTimeout(function(){

			potsa_confirm.style.display = 'block';
			success_sfx.play();

		},60000); //timeout redirect 1 minute.
	},1000); //timeout potsachanges 1 second.
}

// POTSA
const wd = "potsa";
let currentIndex = 0;
let potsa_triggered = false;

document.addEventListener("keydown", (e) => {
  	let key = e.key.toLowerCase();

  	if (key.length === 1 && key.match(/[a-zÃ±]/) && potsa_triggered === false) {
   		if (key === wd[currentIndex]) {

      		if (unete_on == true) {uneteanosotros();}

      		if (currentIndex == 0) {
      			body.style.backgroundImage = "url('media/potsa_god.png')";

      		} else if (currentIndex == 1) {
      			body.style.backgroundImage = "url('media/potsa_free.png')";

      		} else if (currentIndex == 2) {
      			body.style.backgroundImage = "url('media/dpyPotsa.gif')";

      		} else if (currentIndex == 3) {
      			body.style.backgroundImage = "url('media/sebusca.jpg')";

      		} else if (currentIndex == 4) {
      			body.style.backgroundImage = "url('media/retrotsa.png')";
      		}

      		console.log(`"${key}" (${currentIndex + 1}/${wd.length})`);

      		const currentText = wd.substring(0, currentIndex + 1);
      		document.getElementById('potsa_say').textContent = currentText;

      		randomHitSound();
      		currentIndex++;

      		if (currentIndex === wd.length) {
        		console.log(wd + " !!!!!!!");
        		currentIndex = 0;
        		potsa_triggered = true;

        		potsa_trigger();
      		}
    	} else {return;}
  	}
});


document.addEventListener('keydown', event =>  {
  if (event.code === 'Space' | event.code === 'Enter') {
    uneteanosotros();
  }
});

window.onload = function() {body.focus()};

</script>
</body>
</html>